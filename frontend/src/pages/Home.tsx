import * as React from "react";

import { Signer, ethers } from "ethers";

import Box from "@mui/material/Box";
import Button from "@mui/material/Button";
import Modal from "@mui/material/Modal";
import Typography from "@mui/material/Typography";
import { contractInterface } from "../lib/utils";

const style = {
  position: "absolute" as "absolute",
  top: "50%",
  left: "50%",
  transform: "translate(-50%, -50%)",
  width: 400,
  bgcolor: "background.paper",
  border: "2px solid #000",
  boxShadow: 24,
  p: 4,
};

export default function Home() {
  const [open, setOpen] = React.useState(true);
  const handleOpen = () => setOpen(true);
  const handleClose = () => setOpen(false);

  async function deployMyContract(): Promise<void> {
    const { ethereum } = window as any;
    const provider = new ethers.providers.Web3Provider(ethereum);
    const signer = provider.getSigner();

    const myContractFactory = new ethers.ContractFactory(
      contractInterface,
      "0x6104ea610053600b82828239805160001a607314610046577f4e487b7100000000000000000000000000000000000000000000000000000000600052600060045260246000fd5b30600052607381538281f3fe730000000000000000000000000000000000000000301460806040526004361061004b5760003560e01c80630cd822cf146100505780638ba1785114610079578063fb63cddc146100a2575b600080fd5b81801561005c57600080fd5b506100776004803603810190610072919061029b565b6100d3565b005b81801561008557600080fd5b506100a0600480360381019061009b919061029b565b610138565b005b6100bc60048036038101906100b7919061029b565b6101be565b6040516100ca929190610305565b60405180910390f35b6000806100e084846101be565b809250819350505080610128576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161011f9061038b565b60405180910390fd5b6101328483610138565b50505050565b816006016001836006018054905061015091906103da565b815481106101615761016061040e565b5b90600052602060002001548260060182815481106101825761018161040e565b5b9060005260206000200181905550816006018054806101a4576101a361043d565b5b600190038181906000526020600020016000905590555050565b60008060005b846006018054905081101561021a57838560060182815481106101ea576101e961040e565b5b906000526020600020015403610207578060019250925050610223565b80806102129061046c565b9150506101c4565b50600080915091505b9250929050565b600080fd5b6000819050919050565b6102428161022f565b811461024d57600080fd5b50565b60008135905061025f81610239565b92915050565b6000819050919050565b61027881610265565b811461028357600080fd5b50565b6000813590506102958161026f565b92915050565b600080604083850312156102b2576102b161022a565b5b60006102c085828601610250565b92505060206102d185828601610286565b9150509250929050565b6102e481610265565b82525050565b60008115159050919050565b6102ff816102ea565b82525050565b600060408201905061031a60008301856102db565b61032760208301846102f6565b9392505050565b600082825260208201905092915050565b7f4e6f206d61746368657320696e20636f70794964732061727261790000000000600082015250565b6000610375601b8361032e565b91506103808261033f565b602082019050919050565b600060208201905081810360008301526103a481610368565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006103e582610265565b91506103f083610265565b9250828203905081811115610408576104076103ab565b5b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603160045260246000fd5b600061047782610265565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82036104a9576104a86103ab565b5b60018201905091905056fea26469706673582212205d3c37aed0c1d42408bea09ef49cb7a36883daa822e5dd815d122cdd1774a1af64736f6c63430008110033",
      signer
    );

    try {
      const myContract = await myContractFactory.deploy();

      // await myContractFactory.deployed();

      window.alert(`nftColletion deployed to: ${myContractFactory}`);
    } catch (error: any) {
      window.alert(
        "Error!" + (error && error.message ? `\n\n${error.message}` : "")
      );
    }
  }

  return (
    <div>
      <Button onClick={handleOpen}>Open modal</Button>
      <Modal
        open={open}
        onClose={handleClose}
        aria-labelledby="modal-modal-title"
        aria-describedby="modal-modal-description"
      >
        <Box sx={style}>
          <Typography id="modal-modal-title" variant="h6" component="h2">
            Deploy Library smart contract
          </Typography>
          <Typography id="modal-modal-description" sx={{ mt: 2 }}>
            <button
              onClick={() => {
                deployMyContract();
              }}
            >
              Test
            </button>
          </Typography>
        </Box>
      </Modal>
    </div>
  );
}
